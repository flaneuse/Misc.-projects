# Zambia Feed the Future Midline data -----------------------------------------
#
# ZMB_FtFmidline.R: script to visualize Zambia's baseline and midline data from
# the 2015 Zone of Influence Interim Assessment
#
# Data are from USAID's Bureau for Food Security from the draft of the interim report
#
# Laura Hughes, lhughes@usaid.gov, 6 October 2016
#
# Copyright 2016 by Laura Hughes via MIT License
# setup, load packages ----------------------------------------------------
base_dir = '~/Documents/USAID/mini projects/Zambia FtF changes - (BFS)/'
colorFemale = "#9483BD"
colorMale = "#27aae1"
colorTarget = '#fdae61'
size_dot = 5
stroke_dot = 0.2
stroke_line = 0.75
alpha_ci = 0.25
width_ci = 2
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(data.table)
library(ggplot2)
library(llamar)
library(extrafont)
loadfonts()
# import data -------------------------------------------------------------
df = read_excel(paste0(base_dir, 'Zambia_Interim_Country_Report_9.26.16 Exec Sum table.xlsx'),
na = 'NA')
dhs = read_excel(paste0(base_dir, 'ZMB_DHS_malnutrition.xlsx'))
# clean FTF data ----------------------------------------------------------
# tidy data frame
est = df %>%
select(indicator, disaggregation, baseline_est, interim_est) %>%
gather(year_est, est, c(baseline_est, interim_est)) %>%
mutate(year = ifelse(year_est %like% 'baseline', 2012,
ifelse(year_est %like% 'interim', 2015, NA)))
ci = df %>%
select(indicator, disaggregation, baseline_CI, interim_CI) %>%
gather(year_ci, CI, c(baseline_CI, interim_CI)) %>%
mutate(year = ifelse(year_ci %like% 'baseline', 2012,
ifelse(year_ci %like% 'interim', 2015, NA)))
n = df %>%
select(indicator, disaggregation, baseline_n, interim_n) %>%
gather(year_n, n, c(baseline_n, interim_n)) %>%
mutate(year = ifelse(year_n %like% 'baseline', 2012,
ifelse(year_n %like% 'interim', 2015, NA)))
tidy = left_join(est, ci, by = c('year', 'indicator', 'disaggregation'))
tidy = left_join(tidy, n, by = c('year', 'indicator', 'disaggregation'))
# split CIs into two columns
untidy = df %>%
mutate(base_CI = baseline_CI,
mid_CI = interim_CI) %>%
rowwise() %>%
separate(baseline_CI, into = c('baseline_lb', 'baseline_ub'), sep = ' – ') %>%
separate(interim_CI, into = c('interim_lb', 'interim_ub'), sep = ' – ') %>%
mutate(baseline_lb= as.numeric(baseline_lb),
baseline_ub= as.numeric(baseline_ub),
interim_lb = as.numeric(interim_lb),
interim_ub = as.numeric(interim_ub))
tidy = tidy %>%
mutate(ci_cpy = CI) %>%
rowwise() %>%
separate(CI, into = c('lb', 'ub'), sep = ' – ') %>%
mutate(lb = as.numeric(lb),
ub = as.numeric(ub))
untidy = untidy %>%
ungroup() %>%
mutate(sex = case_when(untidy$disaggregation %like% 'All children' ~ 'total',
untidy$disaggregation %like% 'Female' ~ 'female',
untidy$disaggregation %like% 'Male' ~ 'male',
TRUE ~ NA_character_))
tidy = tidy %>%
ungroup() %>%
mutate(sex = case_when(tidy$disaggregation %like% 'All children' ~ 'total',
tidy$disaggregation %like% 'Female' ~ 'female',
tidy$disaggregation %like% 'Male' ~ 'male',
TRUE ~ NA_character_))
# clean dhs ---------------------------------------------------------------
dhs = dhs %>%
mutate(est = Value/100,
sex = case_when(dhs$`Characteristic Label` %like% 'Total' ~ 'total',
dhs$`Characteristic Label` %like% 'Female' ~ 'female',
dhs$`Characteristic Label` %like% 'Male' ~ 'male',
TRUE ~ NA_character_))
# stunting plots ----------------------------------------------------------
stunting_target = .376 # from FTF-MS
st_tidy = tidy %>% filter(indicator %like% 'stunt') %>%
select(year, est, lb, ub, n, sex) %>%
# percent-ize
mutate(est = est/100,
lb = lb/100,
ub = ub/100,
group = 'FTF')
st_dhs = dhs %>% filter(Indicator %like% 'stunt') %>%
select(year = `Survey Year`, est, sex) %>%
mutate(group = 'DHS', lb = NA, ub = NA)
st_tidy = bind_rows(st_tidy, st_dhs)
st_untidy = untidy %>% filter(indicator %like% 'stunt') %>%
# percent-ize
mutate(baseline_est = baseline_est/100,
interim_est = interim_est/100)
ggplot(st_tidy, aes(fill = sex, colour = sex,
alpha = group, size = group)) +
# -- target --
geom_hline(colour = colorTarget, yintercept = stunting_target, size = 0.25) +
# -- CIs --
# geom_segment(aes(x = year, xend = year, y = lb, yend = ub),
# alpha = alpha_ci, size = width_ci*100) +
geom_segment(aes(x = year, xend = year, y = lb, yend = ub, group = group),
alpha = alpha_ci, size = width_ci) +
# -- connector --
geom_line(aes(x = year, y = est, group = group,
linetype = group),
size = stroke_line) +
# -- point estimate --
geom_point(aes(x = year, y = est,
shape = sex, group = group),
stroke = stroke_dot,
colour = grey90K) +
geom_text(aes(x = year, y = est,
label = round(est*100,0), group = group),
size = 2, family = 'Lato',
colour = 'white') +
# -- scales --
scale_y_continuous(labels = scales::percent) +
scale_x_continuous(breaks = c(1992, 2002, 2012, 2015), position = 'top') +
scale_colour_manual(values = c('total' = grey50K, 'female' = colorFemale, 'male' = colorMale)) +
scale_fill_manual(values = c('total' = grey50K, 'female' = colorFemale, 'male' = colorMale)) +
scale_alpha_discrete(range = c(0.25, 1)) +
scale_size_discrete(range = c(size_dot/2, size_dot)) +
scale_shape_manual(values = c('total' = 21, 'female' = 22, 'male' = 23)) +
scale_linetype_manual(values = c('DHS' = 2, 'FTF' = 1)) +
# -- themes --
theme_ygrid() +
theme(rect = element_rect(fill = grey10K, colour = grey25K, size = 0, linetype = 1),
panel.background = element_rect(fill = 'white'),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 12),
strip.text = element_text(family = 'Lato Light', colour = grey90K, size = 14)) +
# -- annotation --
annotate(geom = 'text', label = 'DHS', x = 1992, y = 0.5, family = 'Lato Light', size = 5) +
annotate(geom = 'text', label = 'FTF ZOI', x = 2012, y = 0.5, family = 'Lato Light', size = 5) +
ggtitle('Stunting prevalence decreased in the ZOI, mirroring a national trend',
subtitle = 'percent of stunted children under 5 years of age')  +
facet_wrap(~ sex)
save_plot('~/Creative Cloud Files/MAV/Projects/ZMB_FTFmidline_2016-10/ZMB_stunting.pdf', width = 8, height = 4.5)
# wasting plots ----------------------------------------------------------
wasting_target = 0.025 # from FTF-MS
wast_tidy = tidy %>% filter(indicator %like% 'wast') %>%
select(year, est, lb, ub, n, sex) %>%
# percent-ize
mutate(est = est/100,
lb = lb/100,
ub = ub/100,
group = 'FTF')
wast_dhs = dhs %>% filter(Indicator %like% 'wast') %>%
select(year = `Survey Year`, est, sex) %>%
mutate(group = 'DHS', lb = NA, ub = NA)
wast_tidy = bind_rows(wast_tidy, wast_dhs)
ggplot(wast_tidy, aes(fill = sex, colour = sex,
alpha = group, size = group)) +
# -- target --
geom_hline(colour = colorTarget, yintercept = wasting_target, size = 0.25) +
# -- CIs --
# geom_segment(aes(x = year, xend = year, y = lb, yend = ub),
# alpha = alpha_ci, size = width_ci*100) +
geom_segment(aes(x = year, xend = year, y = lb, yend = ub, group = group),
alpha = alpha_ci, size = width_ci) +
# -- connector --
geom_line(aes(x = year, y = est, group = group,
linetype = group),
size = stroke_line) +
# -- point estimate --
geom_point(aes(x = year, y = est,
shape = sex, group = group),
stroke = stroke_dot,
colour = grey90K) +
geom_text(aes(x = year, y = est,
label = round(est*100,0), group = group),
size = 2, family = 'Lato',
colour = 'white') +
# -- scales --
scale_y_continuous(labels = scales::percent) +
scale_x_continuous(breaks = c(1992, 2002, 2012, 2015), position = 'top') +
scale_colour_manual(values = c('total' = grey50K, 'female' = colorFemale, 'male' = colorMale)) +
scale_fill_manual(values = c('total' = grey50K, 'female' = colorFemale, 'male' = colorMale)) +
scale_alpha_discrete(range = c(0.25, 1)) +
scale_size_discrete(range = c(size_dot/2, size_dot)) +
scale_shape_manual(values = c('total' = 21, 'female' = 22, 'male' = 23)) +
scale_linetype_manual(values = c('DHS' = 2, 'FTF' = 1)) +
# -- themes --
theme_ygrid() +
theme(rect = element_rect(fill = grey10K, colour = grey25K, size = 0, linetype = 1),
panel.background = element_rect(fill = 'white'),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 12),
strip.text = element_text(family = 'Lato Light', colour = grey90K, size = 14)) +
# -- annotation --
annotate(geom = 'text', label = 'national (DHS)', x = 1992, y = 0.1, family = 'Lato Light', size = 5) +
annotate(geom = 'text', label = 'FTF ZOI', x = 2012, y = 0.1, family = 'Lato Light', size = 5) +
ggtitle('While nationally wasting has remained around 6% for the past 2 decades, it is lower in the ZOI',
subtitle = 'percent of wasted children under 5 years of age')  +
facet_wrap(~ sex)
save_plot('~/Creative Cloud Files/MAV/Projects/ZMB_FTFmidline_2016-10/ZMB_wasting.pdf', width = 8, height = 4.5)
# underweight plots ----------------------------------------------------------
underwt_target = 0.12 # from FTF-MS
under_tidy = tidy %>% filter(indicator %like% 'underweight child') %>%
select(year, est, lb, ub, n, sex) %>%
# percent-ize
mutate(est = est/100,
lb = lb/100,
ub = ub/100,
group = 'FTF')
under_dhs = dhs %>% filter(Indicator %like% 'under') %>%
select(year = `Survey Year`, est, sex) %>%
mutate(group = 'DHS', lb = NA, ub = NA)
under_tidy = bind_rows(under_tidy, under_dhs)
ggplot(under_tidy, aes(fill = sex, colour = sex,
alpha = group, size = group)) +
# -- target --
geom_hline(colour = colorTarget, yintercept = underwt_target, size = 0.25) +
# -- CIs --
# geom_segment(aes(x = year, xend = year, y = lb, yend = ub),
# alpha = alpha_ci, size = width_ci*100) +
geom_segment(aes(x = year, xend = year, y = lb, yend = ub, group = group),
alpha = alpha_ci, size = width_ci) +
# -- connector --
geom_line(aes(x = year, y = est, group = group,
linetype = group),
size = stroke_line) +
# -- point estimate --
geom_point(aes(x = year, y = est,
shape = sex, group = group),
stroke = stroke_dot,
colour = grey90K) +
geom_text(aes(x = year, y = est,
label = round(est*100,0), group = group),
size = 2, family = 'Lato',
colour = 'white') +
# -- scales --
scale_y_continuous(labels = scales::percent) +
scale_x_continuous(breaks = c(1992, 2002, 2012, 2015), position = 'top') +
scale_colour_manual(values = c('total' = grey50K, 'female' = colorFemale, 'male' = colorMale)) +
scale_fill_manual(values = c('total' = grey50K, 'female' = colorFemale, 'male' = colorMale)) +
scale_alpha_discrete(range = c(0.25, 1)) +
scale_size_discrete(range = c(size_dot/2, size_dot)) +
scale_shape_manual(values = c('total' = 21, 'female' = 22, 'male' = 23)) +
scale_linetype_manual(values = c('DHS' = 2, 'FTF' = 1)) +
# -- themes --
theme_ygrid() +
theme(rect = element_rect(fill = grey10K, colour = grey25K, size = 0, linetype = 1),
panel.background = element_rect(fill = 'white'),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 12),
strip.text = element_text(family = 'Lato Light', colour = grey90K, size = 14)) +
# -- annotation --
annotate(geom = 'text', label = 'national (DHS)', x = 1992, y = 0.1, family = 'Lato Light', size = 5) +
annotate(geom = 'text', label = 'FTF ZOI', x = 2012, y = 0.1, family = 'Lato Light', size = 5) +
ggtitle('Underweight CIs are huge.',
subtitle = 'percent of underweight children under 5 years of age')  +
facet_wrap(~ sex)
save_plot('~/Creative Cloud Files/MAV/Projects/ZMB_FTFmidline_2016-10/ZMB_underweight.pdf', width = 8, height = 4.5)
# WEIA --------------------------------------------------------------------
weia = tidy %>%
filter(indicator %like% 'Empowerment') %>%
mutate(est = est/100) # percentize
ggplot(weia, aes(x = est, y = disaggregation)) +
geom_dot() +
facet_wrap(year) +
ggtitle('The single largest gain')
